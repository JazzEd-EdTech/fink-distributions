# -*- coding: ascii; tab-width: 4; x-counterpart: numpy-py.patch -*-
Info2: <<
Package: numpy-py%type_pkg[python]
Version: 1.16.3
Revision: 1
Maintainer: None <fink-devel@lists.sourceforge.net>
Type: python (2.7 3.4 3.5 3.6 3.7)
Depends: <<
    python%type_pkg[python],
    openblas-shlibs
<<
BuildDepends: <<
    cython-py%type_pkg[python],
    openblas,
    setuptools-tng-py%type_pkg[python]
<<
#BuildConflicts: atlas
Source: https://pypi.io/packages/source/n/numpy/numpy-%v.zip
Source-Checksum: SHA256(78a6f89da87eeb48014ec652a65c4ffde370c036d780a995edaeb121d3625621)
#SourceRename: numpy-%v.zip
PatchFile: numpy-py.patch
PatchFile-MD5: cc31d86e01c58157aacfed17b5d558f2
Conflicts: <<
    f2py-py%type_pkg[python],
    scipy-py%type_pkg[python] (<= 1:0.4)
<<
Replaces: <<
    f2py-py%type_pkg[python],
    scipy-py%type_pkg[python] (<= 1:0.4),
    scipy-core-py%type_pkg[python] (<< 1.3.0-6)
<<
Provides: f2py-py%type_pkg[python]
PatchScript: <<
#!/bin/bash -ev
  cat <<EOF > site.cfg
[openblas]
libraries = openblas
library_dirs = %p/lib
include_dirs = %p/include
runtime_library_dirs = %p/lib
EOF
    sed 's|@FINKPREFIX@|%p|g' <%{PatchFile} | patch -p1
<<
CompileScript: <<
    ATLAS=None %p/bin/python%type_raw[python] setup.py build
<<
InstallScript: <<
#!/bin/bash -ev
    ATLAS=None %p/bin/python%type_raw[python] setup.py install --root %d
    # remove unversioned instances of f2py (put under update_alternative management instead?)
    rm %i/bin/f2py %i/bin/f2py[23]

    if [ -f %b/INSTALL_MAKE_CHECK ]; then
        mkdir test
        cd test
        PATH=%i/bin:$PATH
        export LANG=en_US.UTF-8 PYTHONPATH=%i/lib/python%type_raw[python]/site-packages
        # Test framework in 1.16.3 only returns True/False; invert to get exit code 0 on success.
        %p/bin/python%type_raw[python] -B -c "import numpy, sys; sys.exit(not numpy.test())" || exit 2
    fi
<<
InfoTest: <<
    TestDepends: nose-py%type_pkg[python]
    TestScript: touch %b/INSTALL_MAKE_CHECK
<<
DocFiles: LICENSE.txt
Description: N-dimensional array package for Python
DescDetail: <<
NumPy (formerly known as scipy_core) is the fundamental package needed
for scientific computing with Python. It contains among other things:

  - a powerful N-dimensional array object
  - sophisticated (broadcasting) functions
  - tools for integrating C/C++ and Fortran code
  - useful linear algebra, Fourier transform, and random number capabilities.

Besides its obvious scientific uses, NumPy can also be used as an
efficient multi-dimensional container of generic data. Arbitrary
data-types can be defined. This allows NumPy to seamlessly and
speedily integrate with a wide variety of databases.
<<
DescPackaging:  <<
https://github.com/numpy/numpy/issues/5229
Seems to be fixed in 1.10 (at least for Yosemite and El Capitan).
Impossible to issue a warning for the potential failures as a 'sys.exit(1)'
causes the install phase to immediately exit (thanks to 'bash -e'?).

Set SHELL (%v >= 1.13.0) because fink-bld's shell is /usr/bin/false and several configure test programs require a real shell.
https://sourceforge.net/p/fink/package-submissions/4930/#467b

But on 10.13+, we need to not use SHELL from the environment, but hardcode a real shell.
https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=225156
Dependent packages that see this bug should depend on numpy-py%type_pkg[python] (>= 1.14.5-2).
<<
License: OSI-Approved
Homepage: http://www.numpy.org
# Info2
<<
